<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>Leitor de Documentos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/7.1.0/collection/components/icon/icon.min.css">
  <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/7.1.0/ionicons/ionicons.esm.js"></script>
  <style>
    :root{
      --bg: #ffffff;
      --accent: #111111;
      --muted: #5b5b5b;
      --text-primary: #111111;
      --text-secondary: #5b5b5b;
      --border: #e5e5e5;
      --card-bg: #ffffff;
      --shadow: 0 4px 12px rgba(16,16,16,0.08);
    }

    [data-theme="dark"]{
      --bg: #000000;
      --accent: #ffffff;
      --muted: #a0a0a0;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --border: #2a2a2a;
      --card-bg: #1a1a1a;
      --shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }
    
    html,body{height:100%;overflow-x:hidden;}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background:var(--bg);
      color:var(--text-primary);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .app {
      min-height:100vh;
      display:flex;
      flex-direction:column;
      background: var(--bg);
    }

    header{
      padding: 12px 24px;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 100;
      border-bottom: 1px solid var(--border);
    }

    h1{
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .theme-btn{
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: background 0.2s ease;
    }

    .theme-btn:hover{
      background: var(--border);
    }

    .theme-btn ion-icon{
      font-size: 24px;
      color: var(--text-primary);
    }

    .content{
      flex: 1;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .upload-section{
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 48px 24px;
      border: 2px dashed var(--border);
      border-radius: 16px;
      background: var(--card-bg);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .upload-section:hover{
      border-color: var(--accent);
      background: var(--bg);
    }

    .upload-section ion-icon{
      font-size: 64px;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    .upload-section h2{
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .upload-section p{
      font-size: 14px;
      color: var(--text-secondary);
    }

    input[type="file"]{
      display: none;
    }

    .search-box{
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--card-bg);
      color: var(--text-primary);
      font-size: 16px;
      font-family: inherit;
      outline: none;
      transition: all 0.2s ease;
      display: none;
    }

    .search-box.active{
      display: block;
    }

    .search-box:focus{
      border-color: var(--accent);
    }

    .document-container{
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      min-height: 400px;
      display: none;
    }

    .document-container.active{
      display: block;
    }

    .document-content{
      line-height: 1.8;
      color: var(--text-primary);
      white-space: pre-wrap;
      font-size: 15px;
    }

    .highlight{
      background-color: #fbbf24;
      padding: 2px 4px;
      border-radius: 2px;
    }

    .loading{
      text-align: center;
      padding: 48px;
      color: var(--text-secondary);
      font-size: 16px;
    }

    .file-info{
      display: none;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .file-info.active{
      display: flex;
    }

    .file-info ion-icon{
      font-size: 24px;
      color: var(--text-secondary);
    }

    .file-details{
      flex: 1;
    }

    .file-name{
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .file-size{
      font-size: 12px;
      color: var(--text-secondary);
    }

    .close-btn{
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
    }

    .close-btn:hover{
      background: var(--border);
    }

    .close-btn ion-icon{
      font-size: 20px;
      color: var(--text-secondary);
    }
  </style>
</head>
<body data-theme="light">
  <div class="app">
    <header>
      <h1>ðŸ“„ Leitor de Documentos</h1>
      <button class="theme-btn" id="themeBtn">
        <ion-icon name="sunny-outline" id="themeIcon"></ion-icon>
      </button>
    </header>

    <div class="content">
      <div class="file-info" id="fileInfo">
        <ion-icon name="document-text-outline"></ion-icon>
        <div class="file-details">
          <div class="file-name" id="fileName"></div>
          <div class="file-size" id="fileSize"></div>
        </div>
        <button class="close-btn" id="closeBtn">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <div class="upload-section" id="uploadSection">
        <ion-icon name="cloud-upload-outline"></ion-icon>
        <h2>Carregar documento</h2>
        <p>PDF, DOC ou DOCX</p>
        <input type="file" id="fileInput" accept=".pdf,.doc,.docx">
      </div>

      <input type="text" class="search-box" id="searchBox" placeholder="Procurar no documento...">

      <div class="document-container" id="documentContainer">
        <div class="document-content" id="documentContent"></div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    let currentTheme = localStorage.getItem('theme') || 'light';
    let originalText = '';
    let currentFile = null;

    document.body.setAttribute('data-theme', currentTheme);

    const themeBtn = document.getElementById('themeBtn');
    const themeIcon = document.getElementById('themeIcon');
    const uploadSection = document.getElementById('uploadSection');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const closeBtn = document.getElementById('closeBtn');
    const searchBox = document.getElementById('searchBox');
    const documentContainer = document.getElementById('documentContainer');
    const documentContent = document.getElementById('documentContent');

    function updateThemeIcon() {
      if (currentTheme === 'dark') {
        themeIcon.setAttribute('name', 'moon-outline');
      } else {
        themeIcon.setAttribute('name', 'sunny-outline');
      }
    }

    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', currentTheme);
      localStorage.setItem('theme', currentTheme);
      updateThemeIcon();
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / 1048576).toFixed(1) + ' MB';
    }

    async function readPDF(arrayBuffer) {
      const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
      let fullText = '';
      
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const textContent = await page.getTextContent();
        const pageText = textContent.items.map(item => item.str).join(' ');
        fullText += pageText + '\n\n';
      }
      
      return fullText;
    }

    async function processFile(file) {
      currentFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      fileInfo.classList.add('active');
      
      documentContent.innerHTML = '<div class="loading">A carregar documento...</div>';
      documentContainer.classList.add('active');
      uploadSection.style.display = 'none';

      const reader = new FileReader();
      reader.onload = async function(event) {
        try {
          const arrayBuffer = event.target.result;
          let text = '';
          
          if (file.name.toLowerCase().endsWith('.pdf')) {
            text = await readPDF(arrayBuffer);
          } else {
            const result = await mammoth.extractRawText({arrayBuffer: arrayBuffer});
            text = result.value;
          }
          
          originalText = text;
          documentContent.textContent = originalText;
          searchBox.classList.add('active');
        } catch (error) {
          documentContent.innerHTML = '<div class="loading">Erro ao ler o documento</div>';
        }
      };
      reader.readAsArrayBuffer(file);
    }

    uploadSection.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        processFile(file);
      }
    });

    closeBtn.addEventListener('click', () => {
      currentFile = null;
      originalText = '';
      fileInfo.classList.remove('active');
      documentContainer.classList.remove('active');
      searchBox.classList.remove('active');
      searchBox.value = '';
      uploadSection.style.display = 'flex';
      fileInput.value = '';
    });

    searchBox.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      
      if (!searchTerm) {
        documentContent.textContent = originalText;
        return;
      }

      const regex = new RegExp(`(${searchTerm})`, 'gi');
      const highlightedText = originalText.replace(regex, '<span class="highlight">$1</span>');
      documentContent.innerHTML = highlightedText;
    });

    themeBtn.addEventListener('click', toggleTheme);

    updateThemeIcon();
  </script>
</body>
</html>