<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HTML → PDF (simples)</title>
  <style>
    :root{font-family:system-ui,Segoe UI,Roboto,Arial;--gap:12px}
    body{margin:18px;background:#f7f7f8;color:#111}
    h1{font-size:18px;margin:0 0 8px}
    .wrap{display:grid;grid-template-columns:1fr 420px;gap:var(--gap);align-items:start}
    textarea{width:100%;height:420px;padding:10px;font-family:monospace;font-size:13px;box-sizing:border-box;resize:vertical}
    .controls{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
    button{padding:8px 12px;border:0;background:#0b5cff;color:#fff;border-radius:6px;cursor:pointer}
    button.secondary{background:#6b7280}
    input[type="text"]{padding:8px;border:1px solid #ddd;border-radius:6px;width:100%}
    iframe#preview{width:100%;height:360px;border:1px solid #ddd;border-radius:6px;background:#fff}
    .panel{background:#fff;padding:12px;border-radius:8px;border:1px solid #e6e6e8}
    .note{font-size:12px;color:#555;margin-top:8px}
    @media (max-width:920px){ .wrap{grid-template-columns:1fr} iframe#preview{height:280px} textarea{height:260px} }
  </style>
</head>
<body>
  <h1>Converter HTML para PDF — Simples</h1>

  <div class="wrap">
    <!-- Editor -->
    <div>
      <div class="panel">
        <div class="controls">
          <button id="previewBtn" type="button">Visualizar</button>
          <button id="pdfBtn" type="button">Converter para PDF</button>
          <button id="clearBtn" class="secondary" type="button">Limpar</button>
        </div>

        <label for="filename">Nome do ficheiro (.pdf)</label>
        <input id="filename" type="text" value="documento.pdf" />

        <label style="display:block;margin-top:10px;font-weight:600">Cole ou escreva o código HTML abaixo</label>
        <textarea id="htmlInput" placeholder="&lt;!doctype html&gt;&lt;html&gt;..."></textarea>

        <div class="note">
          Dica: use estilos inline ou &lt;style&gt; no topo do HTML inserido. Scripts inline normalmente não serão executados no PDF.
        </div>
      </div>
    </div>

    <!-- Preview & opções -->
    <div>
      <div class="panel">
        <strong>Pré-visualização</strong>
        <iframe id="preview" sandbox="allow-same-origin"></iframe>

        <div style="margin-top:10px">
          <label><input id="landscape" type="checkbox"> Paisagem (landscape)</label>
        </div>
        <div class="note">
          Conversão usa biblioteca html2pdf (jsPDF + html2canvas). Se preferir impressão nativa, use "Visualizar" e depois imprimir no navegador.
        </div>
      </div>
    </div>
  </div>

  <!-- área escondida que receberá o HTML para conversão -->
  <div id="render" style="position:fixed;left:-9999px;top:-9999px;width:210mm;box-sizing:border-box"></div>

  <!-- html2pdf (bundle inclui jsPDF & html2canvas) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <script>
    const htmlInput = document.getElementById('htmlInput');
    const preview = document.getElementById('preview');
    const render = document.getElementById('render');
    const previewBtn = document.getElementById('previewBtn');
    const pdfBtn = document.getElementById('pdfBtn');
    const clearBtn = document.getElementById('clearBtn');
    const filenameInput = document.getElementById('filename');
    const landscapeCheckbox = document.getElementById('landscape');

    // Exemplo curto para começar
    htmlInput.value = `<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <style>body{font-family:Arial,Helvetica,sans-serif;padding:20px;color:#111} h2{margin-top:0}</style>
</head>
<body>
  <h2>Minha Página</h2>
  <p>Este é um exemplo simples convertido em PDF.</p>
</body>
</html>`.trim();

    // Função de pré-visualizar: define o srcdoc do iframe e atualiza a área de render (mesmo conteúdo)
    function doPreview() {
      const html = htmlInput.value || '<!doctype html><html><body><p>Sem conteúdo</p></body></html>';
      // preview como srcdoc (não executa scripts por causa do atributo sandbox)
      preview.srcdoc = html;
      // render usado por html2pdf: coloca o mesmo conteúdo (sem scripts executáveis)
      render.innerHTML = html;
      // ajustar largura CSS para A4 portrait/landscape
      render.style.width = landscapeCheckbox.checked ? '297mm' : '210mm';
    }

    previewBtn.addEventListener('click', () => {
      doPreview();
      // foco visual
      preview.scrollIntoView({behavior:'smooth'});
    });

    clearBtn.addEventListener('click', () => {
      htmlInput.value = '';
      preview.srcdoc = '';
      render.innerHTML = '';
    });

    pdfBtn.addEventListener('click', async () => {
      doPreview(); // garante render atualizado
      const filename = (filenameInput.value || 'documento.pdf').trim();
      const isLandscape = landscapeCheckbox.checked;

      // opções básicas para html2pdf
      const opt = {
        margin:       10,               // mm
        filename:     filename,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, useCORS: true, logging: false },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: isLandscape ? 'landscape' : 'portrait' }
      };

      try {
        // from(render) usa o elemento visível no DOM; scripts inline não serão executados
        await html2pdf().set(opt).from(render).save();
      } catch (err) {
        alert('Erro ao gerar PDF: ' + err.message);
        console.error(err);
      }
    });

    // Render inicial
    doPreview();
  </script>
</body>
</html>