<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OAuth Redirect — madeeasy</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f7f7f8; color:#111; }
    .card { text-align:center; max-width:640px; padding:24px; border-radius:12px; background:white; box-shadow:0 8px 30px rgba(0,0,0,0.08); }
    a.small{ color:#ff444f; text-decoration:none; font-weight:600 }
    pre { text-align:left; background:#f4f4f6; padding:12px; border-radius:8px; overflow:auto; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Redirecionando para a app…</h2>
    <p>Se o redirecionamento automático falhar, usa o botão abaixo.</p>
    <p><a id="manual" class="small" href="#">Abrir no app</a></p>
    <p style="color:#666;margin-top:8px;font-size:13px">Redirect HTTPS: <strong>https://alfredoooh.github.io/database/oauth-redirect/</strong></p>
    <small style="color:#666;display:block;margin-top:8px">Feito por madeeasy</small>
  </div>

  <script>
    (function() {
      try {
        // Obtem string de query (ex: ?token=...) OU fragment (ex: #access_token=...)
        var qs = window.location.search || '';
        var hash = window.location.hash || '';

        // Se tiver fragment (hash), converte para query: '#access_token=abc' -> '?access_token=abc'
        if ((!qs || qs.length === 0) && hash && hash.length > 0) {
          qs = '?' + hash.substring(1);
        }

        // Se ambos existirem, preserva ambos (concatena com &)
        if (window.location.search && window.location.hash) {
          // remove leading '?' e '#' e concatena
          var q = window.location.search.substring(1);
          var h = window.location.hash.substring(1);
          qs = '?' + q + (h ? ('&' + h) : '');
        }

        // Construir target custom-scheme mantendo parâmetros
        var target = 'com.nexa.madeeasy://oauth' + qs;

        // Atualiza link manual
        var link = document.getElementById('manual');
        if (link) link.href = target;

        // Redirect automático (tenta 3 formas)
        setTimeout(function() {
          // 1) location.href (mais compatível)
          window.location.href = target;
          // 2) fallback: open
          setTimeout(function(){ try { window.open(target, '_self'); } catch(e){} }, 200);
        }, 250);

      } catch (e) {
        console.error('Redirect error', e);
      }
    })();
  </script>
</body>
</html>