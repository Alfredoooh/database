<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Documento Acadêmico</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <style>
        :root {
            --bg: #505050;
            --bar-bg: #ffffff;
            --accent: #111111;
            --text-primary: #111111;
            --shadow: 0 4px 12px rgba(16,16,16,0.08);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            background-color: var(--bg);
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        .scroll-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px 20px 100px 20px;
            display: flex;
            justify-content: center;
            -webkit-overflow-scrolling: touch;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            background-color: white;
            padding: 2.54cm;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            margin: 0 auto;
            position: relative;
        }

        .page-number {
            position: absolute;
            top: 1.27cm;
            right: 2.54cm;
            font-size: 12pt;
        }

        [contenteditable="true"]:focus {
            outline: 2px solid #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }

        p {
            line-height: 2;
            text-align: justify;
            font-size: 12pt;
            margin-bottom: 0;
        }

        .indent {
            text-indent: 1.27cm;
        }

        .citation {
            margin-left: 2.5cm;
            margin-right: 0;
            margin-top: 0;
            margin-bottom: 12pt;
        }

        table {
            width: 100%;
            max-width: 100%;
            border-collapse: collapse;
            margin: 12pt 0;
            table-layout: fixed;
            word-wrap: break-word;
        }

        th, td {
            border: 1px solid #000;
            padding: 6pt;
            text-align: center;
            font-size: 10pt;
            line-height: 1.5;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        th {
            font-weight: bold;
        }

        .table-label {
            font-weight: bold;
            margin: 12pt 0 6pt 0;
            line-height: 2;
        }

        .table-title {
            text-indent: 1.27cm;
            font-style: italic;
            margin-bottom: 6pt;
            line-height: 2;
        }

        .table-source {
            text-indent: 1.27cm;
            margin-top: 6pt;
            font-style: italic;
            line-height: 2;
            margin-bottom: 0;
        }

        .table-note {
            margin-left: 2.54cm;
            margin-top: 6pt;
            margin-bottom: 12pt;
            line-height: 2;
        }

        .chart-container {
            margin: 12pt 0 0 0;
            page-break-inside: avoid;
        }

        .chart-title {
            font-weight: bold;
            margin-bottom: 12pt;
            font-size: 12pt;
            line-height: 2;
            text-align: center;
        }

        .chart-wrapper {
            border: 1px solid #ccc;
            padding: 10pt;
            background: white;
            width: fit-content;
            margin: 0 auto;
        }

        canvas {
            display: block;
        }

        .bottom-bar-wrapper {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 20px;
            display: flex;
            justify-content: center;
            pointer-events: none;
            z-index: 999;
            padding: 0 20px;
        }

        .bottom-bar {
            pointer-events: auto;
            width: 100%;
            max-width: 500px;
            background: var(--bar-bg);
            border-radius: 999px;
            padding: 8px 16px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .tab {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            padding: 0;
            color: #5b5b5b;
            text-decoration: none;
            border-radius: 50%;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: transparent;
            flex-shrink: 0;
            font-size: 24px;
        }

        .tab:hover {
            background: rgba(128,128,128,0.1);
        }

        .tab:active {
            transform: scale(0.9);
        }

        .tab.active {
            color: var(--accent);
            background: rgba(128,128,128,0.15);
        }

        .center-btn {
            background: var(--accent);
            color: white;
            padding: 14px 28px;
            border-radius: 999px;
            box-shadow: 0 4px 12px rgba(17,17,17,0.2);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            border: none;
            cursor: pointer;
            justify-content: center;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
            height: 48px;
        }

        .center-btn:hover {
            opacity: 0.9;
            box-shadow: 0 6px 16px rgba(17,17,17,0.25);
        }

        .center-btn:active {
            transform: scale(0.96);
        }

        .edit-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .edit-indicator.show {
            display: flex;
        }

        @media (max-width: 520px) {
            .bottom-bar {
                padding: 6px 12px;
                max-width: 90%;
                gap: 4px;
            }
            .center-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
            .tab {
                width: 44px;
                height: 44px;
            }
        }

        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            .bottom-bar-wrapper,
            .edit-indicator {
                display: none !important;
            }
            .page {
                box-shadow: none;
                margin: 0;
                page-break-after: always;
            }
            [contenteditable="true"] {
                outline: none;
            }
        }
    </style>
</head>
<body>
    <div class="edit-indicator" id="editIndicator">
        <ion-icon name="create-outline"></ion-icon>
        Modo de edição ativo
    </div>

    <div class="scroll-container">
        <div class="page" id="document">
            <div class="page-number" contenteditable="true">[Apelido] 2</div>
            
            <p class="citation indent" contenteditable="true">[Para citações de mais de quatro linhas, avance a citação 2.5 cm a partir da margem esquerda e não utilize aspas. Para aplicar esta formatação, no separador Base, na Galeria de Estilos, clique em Citação. Para citações mais curtas, pode colocá-las entre aspas e incorporá-las diretamente no texto.]</p>
            
            <p class="table-label" contenteditable="true">Tabela 1</p>
            
            <p class="table-title" contenteditable="true">[Este Título da Tabela Utiliza um Estilo Chamado "Título da Tabela", Disponível no Separador Base, na Galeria de Estilos]</p>
            
            <table>
                <tr>
                    <th contenteditable="true">Cabeçalho de Coluna</th>
                    <th contenteditable="true">Cabeçalho de Coluna</th>
                    <th contenteditable="true">Cabeçalho de Coluna</th>
                    <th contenteditable="true">Cabeçalho de Coluna</th>
                </tr>
                <tr>
                    <td contenteditable="true">Cabeçalho de Linha</td>
                    <td contenteditable="true">Dados da tabela</td>
                    <td contenteditable="true">Dados da tabela</td>
                    <td contenteditable="true">Dados da tabela</td>
                </tr>
                <tr>
                    <td contenteditable="true">Cabeçalho de Linha</td>
                    <td contenteditable="true">Dados da tabela</td>
                    <td contenteditable="true">Dados da tabela</td>
                    <td contenteditable="true">Dados da tabela</td>
                </tr>
                <tr>
                    <td contenteditable="true">Cabeçalho de Linha</td>
                    <td contenteditable="true">Dados da tabela</td>
                    <td contenteditable="true">Dados da tabela</td>
                    <td contenteditable="true">Dados da tabela</td>
                </tr>
            </table>
            
            <p class="table-source" contenteditable="true">Origem: [Este texto de origem utiliza um estilo chamado "Origem da Tabela", disponível no separador Base, na Galeria de Estilos.]</p>
            
            <p class="table-note" contenteditable="true">a. [Este texto de nota utiliza um estilo chamado "Nota da Tabela", disponível no separador Base, na Galeria de Estilos. As notas da tabela utilizam letras minúsculas em vez de numerais árabes para diferenciá-las das notas nos conteúdos do corpo.]</p>
            
            <div class="chart-container">
                <div class="chart-title" contenteditable="true">Título do Gráfico</div>
                <div class="chart-wrapper">
                    <canvas id="myChart" width="420" height="210"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-bar-wrapper">
        <nav class="bottom-bar" role="navigation">
            <button class="tab" id="tab-zoom-out" aria-label="Diminuir zoom">
                <ion-icon name="remove-outline"></ion-icon>
            </button>
            <button class="tab" id="tab-edit" aria-label="Editar documento">
                <ion-icon name="create-outline"></ion-icon>
            </button>
            <button class="center-btn" id="btn-download" aria-label="Download PDF">
                <ion-icon name="download-outline"></ion-icon>
                <span>PDF</span>
            </button>
            <button class="tab" id="tab-zoom-in" aria-label="Aumentar zoom">
                <ion-icon name="add-outline"></ion-icon>
            </button>
        </nav>
    </div>

    <script>
        let currentZoom = 1;
        let editMode = false;

        const ctx = document.getElementById('myChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Categoria 1', 'Categoria 2', 'Categoria 3', 'Categoria 4'],
                datasets: [{
                    label: 'Série 1',
                    data: [4, 2.5, 3.5, 4.5],
                    backgroundColor: '#d3d3d3',
                    borderColor: '#999',
                    borderWidth: 1
                }, {
                    label: 'Série 2',
                    data: [2.5, 2.5, 2, 3],
                    backgroundColor: '#a9a9a9',
                    borderColor: '#666',
                    borderWidth: 1
                }, {
                    label: 'Série 3',
                    data: [2, 3, 3, 5.5],
                    backgroundColor: '#696969',
                    borderColor: '#333',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: false,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 6,
                        ticks: {
                            stepSize: 1,
                            color: '#000',
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            color: '#ddd'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#000',
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            color: '#000',
                            boxWidth: 15,
                            padding: 10,
                            font: {
                                size: 11
                            }
                        }
                    }
                }
            }
        });

        const tabZoomOut = document.getElementById('tab-zoom-out');
        const tabZoomIn = document.getElementById('tab-zoom-in');
        const tabEdit = document.getElementById('tab-edit');
        const btnDownload = document.getElementById('btn-download');
        const page = document.getElementById('document');
        const editIndicator = document.getElementById('editIndicator');

        tabZoomOut.addEventListener('click', () => {
            if (currentZoom > 0.5) {
                currentZoom -= 0.1;
                page.style.transform = `scale(${currentZoom})`;
                page.style.transformOrigin = 'top center';
            }
        });

        tabZoomIn.addEventListener('click', () => {
            if (currentZoom < 1.5) {
                currentZoom += 0.1;
                page.style.transform = `scale(${currentZoom})`;
                page.style.transformOrigin = 'top center';
            }
        });

        tabEdit.addEventListener('click', () => {
            editMode = !editMode;
            tabEdit.classList.toggle('active', editMode);
            editIndicator.classList.toggle('show', editMode);
            
            const editableElements = document.querySelectorAll('[contenteditable]');
            editableElements.forEach(el => {
                el.contentEditable = editMode;
            });
        });

        btnDownload.addEventListener('click', async () => {
            try {
                const wasEditMode = editMode;
                if (editMode) {
                    editMode = false;
                    tabEdit.classList.remove('active');
                    editIndicator.classList.remove('show');
                    const editableElements = document.querySelectorAll('[contenteditable]');
                    editableElements.forEach(el => {
                        el.contentEditable = false;
                    });
                }

                const originalTransform = page.style.transform;
                page.style.transform = 'scale(1)';
                
                await new Promise(resolve => setTimeout(resolve, 100));

                const element = document.getElementById('document');
                const opt = {
                    margin: [0, 0, 0, 0],
                    filename: 'documento-academico.pdf',
                    image: { 
                        type: 'jpeg', 
                        quality: 0.98 
                    },
                    html2canvas: {
                        scale: 2,
                        useCORS: true,
                        letterRendering: true,
                        logging: false,
                        width: 794,
                        height: 1123,
                        scrollY: 0,
                        scrollX: 0,
                        windowWidth: 794,
                        windowHeight: 1123
                    },
                    jsPDF: {
                        unit: 'px',
                        format: [794, 1123],
                        orientation: 'portrait',
                        hotfixes: ['px_scaling']
                    },
                    pagebreak: { mode: 'avoid-all' }
                };
                
                await html2pdf().set(opt).from(element).save();
                
                page.style.transform = originalTransform;
                
                if (wasEditMode) {
                    editMode = true;
                    tabEdit.classList.add('active');
                    editIndicator.classList.add('show');
                    const editableElements = document.querySelectorAll('[contenteditable]');
                    editableElements.forEach(el => {
                        el.contentEditable = true;
                    });
                }
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF. Por favor, tente novamente.');
            }
        });

        const editableElements = document.querySelectorAll('[contenteditable]');
        editableElements.forEach(el => {
            el.contentEditable = false;
        });
    </script>
</body>
</html>